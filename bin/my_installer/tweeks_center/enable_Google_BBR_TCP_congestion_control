#!/bin/sh
# need superuser : called by my-installer
if [ "$(id -u)" -eq 0 ];then
	_SUPERUSER=""
else
	_SUPERUSER="my-superuser"
fi

if ( [ -f "/etc/sysctl.conf" ] && grep -q 'net.ipv4.tcp_congestion_control = bbr' /etc/sysctl.conf ) || [ -f "/etc/sysctl.d/10-custom-kernel-bbr.conf" ];then # enabled
	tweek_enabled=true 
elif [ "$1" = "--is-enable" ] || [ "$check_tweek" = "true" ];then # disabled and only check
	tweek_enabled=false
else
	say "enable_Google_BBR_TCP_congestion_control"
	echo "net.core.default_qdisc=fq" | ${_SUPERUSER} tee /etc/sysctl.d/10-custom-kernel-bbr.conf > /dev/null 2>&1
	echo "net.ipv4.tcp_congestion_control=bbr" | ${_SUPERUSER} tee -a /etc/sysctl.d/10-custom-kernel-bbr.conf > /dev/null 2>&1
	${_SUPERUSER} sysctl -p
fi

#!/bin/sh
if [ "$(id -u)" -eq 0 ];then
	_SUPERUSER=""
else
	_SUPERUSER="my-superuser"
fi

iwlwificonf="/etc/modprobe.d/iwlwifi.conf"

if find /etc/modprobe.d/ -type f -exec grep -q "^options iwlwifi .*11n_disable=1.*" {} +;then # enabled
	tweek_enabled=true 
elif [ "$1" = "--is-enable" ] || [ "$check_tweek" = "true" ];then # disabled and only check
	tweek_enabled=false
else
	say "disable_11n"
	if [ -f "$iwlwificonf" ];then
		echo 'options iwlwifi 11n_disable=1' | ${_SUPERUSER} tee ${iwlwificonf}
	else
		echo 'options iwlwifi 11n_disable=1' | ${_SUPERUSER} tee -a ${iwlwificonf}
	fi
fi

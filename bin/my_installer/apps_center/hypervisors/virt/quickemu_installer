#!/bin/sh
set -e
. "$__distro_path_lib"

[ -e "$__distro_path_git/quickemu" ] && my-superuser rm -rdf "$__distro_path_git"/quickemu
[ -e "$__distro_path_external/applications/quickemu_gui.desktop" ] && my-superuser rm -rdf "${__distro_path_root}/system_files/applications/quickemu_gui.desktop"

super_clone_repo https://github.com/quickemu-project/quickemu.git "$__distro_path_git"/quickemu
my-superuser ln -sf "$__distro_path_git/quickemu/quickemu" "${__distro_path_root}/system_files/bin"
my-superuser ln -sf "$__distro_path_git/quickemu/quickget" "${__distro_path_root}/system_files/bin"
my-superuser ln -sf "$__distro_path_git/quickemu/quickreport" "${__distro_path_root}/system_files/bin"
my-superuser ln -sf "$__distro_path_git/quickemu/chunkcheck" "${__distro_path_root}/system_files/bin"
my-superuser ln -sf "${_APPS_LIBDIR}/hypervisors/virt/quickemu_gui" "${__distro_path_root}/system_files/bin"
	
my-superuser tee "${__distro_path_root}/system_files/applications/quickemu_gui.desktop" <<- EOF > /dev/null
[Desktop Entry]
Type=Application
Name=QuickEmu GUI
Description=Quickly download, create and run VM of any operating system.
Exec=sh -c quickemu_gui
Icon=${__distro_path_root}/icons/openbox-menu/virtualbox.png
Categories=System;Virtualization;
EOF

my-superuser ln -sf "${__distro_path_root}/system_files/applications/quickemu_gui.desktop" /usr/share/applications
echo ""
echo "quickemu_gui added for quick deploy any VM."
echo "quickemu_gui added for quick deploy any VM."
echo "quickemu_gui added for quick deploy any VM."
rm -f ${__distro_path_root}/system_files/bin/quickemu_installer

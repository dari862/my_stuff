#!/bin/sh
# need superuser : used by keybinds
# rxvt-unicode
# bspwm
set -e
__package_name="${1:-}"
__distro_path_lib="${2:-}"
current_script_path="${3:-}"

. "$__distro_path_lib"
. "${__distro_path_root}/lib/common/WM"

write2file=false

if [ "$__package_name" = "rxvt-unicode" ] || [ "$__package_name" = "rxvt" ];then
	file_to_cat="${file_to_cat} rxvt"
	write2file=true
else
	for command in openbox alacritty kitty mpv ncmpcpp zathura nsxiv thunar clipit conky geany lxterminal viewnior;do
		if [ "$__package_name" = "$command" ];then
			file_to_cat="${file_to_cat} $command.conf"
			write2file=true
			break
		fi
	done
fi

if [ "$write2file" = true ];then
	cat ${file_to_cat} | tee -a "${__distro_path_root}"/system_files/skel/.config/keybinds/keybinds.conf >/dev/null 2>&1
elif [ "$__package_name" = "bspwm" ];then
	sed -i ':a;N;$!ba;s/#;\n#; end of sxhkd/seded_end_of_sxhkd/g;/seded_end_of_sxhkd/ {
  		r sxhkd_bspwm
  		r sxhkd_z_end
  		n
		}' "${__distro_path_root}"/system_files/skel/.config/keybinds/keybinds.conf
fi

for d in /home/*/; do
	if [ -f "${d}${usr_flag_setup_path}" ];then
		# Create config folders if no exists
		file_2_edit="${d}.config/keybinds/keybinds.conf"
		user_and_group=$(stat "$(dirname "$file_2_edit")" -c %u:%g)
		if [ "$__package_name" = "bspwm" ];then
			sed -i ':a;N;$!ba;s/#;\n#; end of sxhkd/seded_end_of_sxhkd/g;/seded_end_of_sxhkd/ {
  				r sxhkd_bspwm
  				r sxhkd_z_end
  				n
				}' "$file_2_edit"
		else
			cat ${file_to_cat} | tee -a "$file_2_edit" >/dev/null 2>&1
		fi
		chown -R "$user_and_group" "$file_2_edit"
	fi
done

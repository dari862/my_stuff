#!/bin/sh
# need superuser : used by keybinds
__distro_path_lib="${1:-$__distro_path_lib}"
current_script_path="${2:-}"

. "$__distro_path_lib"

command_exist() {
	if command -v $1 > /dev/null 2>&1;then
		return
	else
		return 1
	fi
}

skel_keybinds_dir="${__distro_path_root}/system_files/skel/.config/keybinds"

cd "${current_script_path}/skel"

file_to_cat="General.conf"

for command in openbox alacritty kitty mpv ncmpcpp zathura nsxiv thunar clipit conky geany lxterminal rxvt viewnior;do
	if command_exist "$command";then
		file_to_cat="${file_to_cat} $command.conf"
	fi
done

if command_exist sxhkd;then
	file_to_cat="${file_to_cat} sxhkd_general.conf"
	if command_exist bspwm;then
		file_to_cat="${file_to_cat} sxhkd_bspwm.conf"
	fi
	file_to_cat="${file_to_cat} sxhkd_z_end.conf"
fi

file_to_cat="${file_to_cat} myshell.conf"

mkdir -p "${skel_keybinds_dir}"
cat ${file_to_cat} | tee "${skel_keybinds_dir}"/keybinds.conf >/dev/null 2>&1

for d in /home/*/; do
	if [ -f "${usr_setup_flag_file}" ];then
		# Create config folders if no exists
		user_and_group=$(stat "$(dirname "${d}.config")" -c %u:%g)
		d="${d}.config/keybinds"; [ ! -d "$d" ] && mkdir -v "$d" && chown -R "$user_and_group" "$d"
		cp -r "${skel_keybinds_dir}/keybinds.conf" "$d" && chown -R $user_and_group "${d}${CONF_FILE}"
	fi
done

#!/bin/sh -e
if command -v rofi >/dev/null 2>&1; then
    exit 1
fi

if [ "$(id -u)" -ne 0 ]; then
    show_m "‚ùå This script must be run as root (use sudo)."
    exit 1
fi

arg="${1:-}"
. "/usr/share/my_stuff/lib/common/Distro_path"
. "${__distro_path_root}/lib/automount_lib"

show_m() {
    __massage="${1:-}"
     rofi -e "$__massage"
}

Parse_arguments
fill_unmounted_devices_var

for dev in ${unmounted_devices};do
	size=$(lsblk -nbo SIZE "$dev" | head -n1)
	size_gb=$((size / 1024 / 1024 / 1024))
	printf "%s (%s GB)\n" "$dev" "$size_gb"
done

selected_line=""
selected_line=$(printf '%s\n' "${unmounted_devices}" | rofi -dmenu -p "Select device to mount:")

get_uuid_and_fs_type

mount_path=$(printf "" | rofi -dmenu -p "Enter mount point (blank = auto):")

check_mount_path_and_fs_type
run_automount

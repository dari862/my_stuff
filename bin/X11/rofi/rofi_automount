#!/bin/bash
set -e
__mode="rofi"
__user="${1:-}"
__distro_path_lib="${2:-$__distro_path_lib}"

if [ "$(id -u)" -ne 0 ]; then
    popup_terminal --superuser "$0 $USER $__distro_path_lib"
    exit
elif [ -z "$__user" ];then
    printf "‚ùå This script should never be run as super user."
    exit 1
fi

. "$__distro_path_lib"
. "${__distro_path_root}/lib/common/WM"
. "/home/$__user/$Distro_config_dir_name"
RASI_PATH="/home/$__user/.config/rofi/$ROFI_STYLE/runner.rasi"
. "${__distro_path_root}/lib/automount_lib"

Parse_arguments
fill_unmounted_devices_var

for dev in ${unmounted_devices};do
	size=$(lsblk -nbo SIZE "$dev" | head -n1)
	size_gb=$((size / 1024 / 1024 / 1024))
	printf "%s (%s GB)\n" "$dev" "$size_gb"
done

selected_line=""
selected_line=$(printf '%s\n' "${unmounted_devices}" | rofi -dmenu -p "Select device to mount:" -theme "$RASI_PATH")

get_uuid_and_fs_type

mount_path=$(printf "" | rofi -dmenu -p "Enter mount point (blank = auto):" -theme "$RASI_PATH")

check_mount_path_and_fs_type
run_automount

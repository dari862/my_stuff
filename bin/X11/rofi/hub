#!/bin/sh
set -e
# if this line exist script will be part of gui scripts.new_name=Script_Hub
# need superuser : var (_SUPERUSER)
. "$__distro_path_lib"
. "${__distro_path_root}/lib/common/WM"
. "${__distro_path_root}/lib/common/openbox"

_hub_script_dir="${__distro_path_root}/system_files/hub_script"
opt___="${1-}"

if [ "$opt___" = "create" ];then
	if [ "$(id -u)" -eq 0 ];then
		_SUPERUSER=""
	else
		_SUPERUSER="my-superuser"
	fi
	$_SUPERUSER mkdir -p "${_hub_script_dir}"
	_script_for_hub="$(grep -RI "^# if this line exist script will be part of hub script." "${__distro_path_root}/bin" | awk -F: '{print $1}')"
		for script in ${_script_for_hub};do
			$_SUPERUSER ln -sf "$script" "${_hub_script_dir}"
		done
	exit
elif [ -n "$opt___" ];then
	shift 1
	reset_of_opt___="$@"
fi

. "${Distro_config_file}"

script_name_=""
full_script_path=""

#############################################################################
#############################################################################
# list_scripts_hub
#############################################################################
#############################################################################

list_scripts_hub()
{
	\ls $_hub_script_dir
}

scripts_hub()
{
	# Description: a hub that you can execute all the other scripts from
	# Dependencies: rofi, executable dmscripts, all the dependancies from dmscripts
	list_scripts="$(list_scripts_hub)"
	MENU="$(printf "$list_scripts" | rofi -no-config -no-lazy-grab -dmenu -r -i -l 20 -theme "$HOME/.config/rofi/$ROFI_STYLE"/runner.rasi -p '')"
	if [ -n "$MENU" ];then
		script_name_="$MENU"
		full_script_path="${_hub_script_dir}/${script_name_}"
        execuite_scripts_ 
	fi
}

execuite_scripts_()
{
	if [ -f "${full_script_path}" ] && grep -E "popup|yad|rofi" "${full_script_path}";then
		"${full_script_path}"
	else
		echo "this script (${full_script_path}) does not exist"
		help
	fi
}

#############################################################################
#############################################################################
# main_rofi_menu
#############################################################################
#############################################################################

main_rofi_menu()
{
	MENU="$(printf "1- hub for executing script \n2- list of configuration files to edit" | rofi -no-config -no-lazy-grab -dmenu -r -i -l 20 -theme "$HOME/.config/rofi/$ROFI_STYLE"/runner.rasi -p '')"
	case $MENU in
		1-*) scripts_hub ;;
		2-*) confedit ;; # script in bin
		*) main_rofi_menu ;;
	esac
}
#############################################################################
#############################################################################
# main
#############################################################################
#############################################################################

help()
{
	echo "listing script:"
	echo "================="
	list_scripts_hub
	echo ""
	echo "================="
	printf "type s for script hub \ntype c for config editor hub\n" 
}

case $opt___ in
	"") main_rofi_menu ;;
	s) scripts_hub ;;
	c) confedit "$reset_of_opt___";; # script in bin
	h) help ;;
	*) script_name_="${opt___}" && full_script_path="${_hub_script_dir}/${script_name_}" && execuite_scripts_ ;;
esac

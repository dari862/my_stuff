#!/bin/sh
. "$__distro_path_lib"

sleep_time="${2:-0}"
if command -v xfce4-clipman >/dev/null 2>&1;then
	clipboard_manager_name="xfce4-clipman"
	clipboard_manager_command="setsid xfce4-clipman"
elif command -v diodon >/dev/null 2>&1;then
	clipboard_manager_name="diodon"
	clipboard_manager_command="exec diodon"
elif command -v parcellite >/dev/null 2>&1;then
	clipboard_manager_name="parcellite"
	clipboard_manager_command="exec parcellite"
elif command -v clipmenud >/dev/null 2>&1;then
	clipboard_manager_name="clipmenud"
	clipboard_manager_command="exec clipmenud"
	export CM_LAUNCHER="rofi"
elif command -v greenclip >/dev/null 2>&1;then
	clipboard_manager_name="greenclip"
	clipboard_manager_command="greenclip daemon"
else
	clipboard_manager_name="clipmanager"
	clipboard_manager_command="clipmanager"
fi

stop() {
	for prosses in diodon parcellite clipmanager xfce4-clipman greenclip;do
		pidof -q ${prosses} && prosses2kill="$prosses2kill $prosses"
	done
		
	for kill in ${prosses2kill};do
		"${__distro_path_root}"/bin/WM/kill_process.sh $kill &
	done
	
	if pgrep -f "yad.*--class=yadclip" >/dev/null 2>&1;then
		pkill -f "yad.*--class=yadclip" >/dev/null 2>&1
	fi
}

start() {
	if ! pidof -q ${clipboard_manager_command};then
		sleep ${sleep_time}
		setsid ${clipboard_manager_command} &
	fi
}

start_gui() {
	if ! pgrep -f "yad.*--class=yadclip" >/dev/null 2>&1;then
		sleep ${sleep_time}
		yadclip &
	fi
}

case "${1}" in
	""|restart)
		stop
		start		
	;;
	start)
		start		
	;;
	start-gui)	
		start
		start_gui	
	;;
	stop)	
		stop	
	;;
	*)	
		echo "Usage: diodon-session [start|stop|restart]"
	;;
esac

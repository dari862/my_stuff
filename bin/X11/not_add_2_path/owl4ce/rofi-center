#!/bin/sh
. "$__distro_path_lib"
exec >/dev/null 2>&1
. "${__distro_path_root}/lib/common/WM"
. "${Distro_config_file}"

__opt="${1-}"

cd "$HOME/.config/rofi/$ROFI_STYLE"

__wall(){
	WALLPAPER="$(
    	for LS in "$__distro_path_wallpaper/$CHK_THEME"*; do
        	[ ! -f "$LS" ] || echo "${LS##*/}"
    	done | rofi -config "config.rasi" -theme-str '@import "action.rasi"' \
                                   	-no-show-icons \
                                   	-no-lazy-grab \
                                   	-no-plugins \
                                   	-dmenu \
                                   	-mesg 'Select X Wallpaper'
	)"
	${__distro_path_root}/bin/X11/not_add_2_path/owl4ce/owl4ce_scripts set-wallpaper "$__distro_path_wallpaper" "$WALLPAPER"
}

__rofi_launcher(){
	exec rofi -config "config.rasi" -theme-str '@import "main.rasi"' \
          	-no-lazy-grab -show drun
}

__BUTTON(){
	OB_BUTTON_STYLE_DIR="${__distro_path_all_distro_themes}/openbox_themes_creater/baseGTK"
	GTK_THEME_NAME="$(awk -F= '/^gtk-theme-name=/{print $2}' $HOME/.config/gtk-3.0/settings.ini)"
	BUTTON="$(for LS in "$OB_BUTTON_STYLE_DIR"/"openbox-${GTK_THEME_NAME}"_*; do
              	if [ -f "$LS" ];then
              		echo "${LS##*_}"
              	fi
              done | rofi -config "config.rasi" -theme-str '@import "action.rasi"' \
                         		-no-show-icons -no-lazy-grab -no-plugins -dmenu \
                         		-mesg 'Select Window Button-Style')"
	"${__distro_path_root}"/bin/X11/not_add_2_path/owl4ce/owl4ce_scripts set-button "openbox-${GTK_THEME_NAME}_${BUTTON}"
}

__center(){
	rofi_center_modi_path="${__distro_path_root}/bin/X11/not_add_2_path/owl4ce/rofi-center-modi"
	
	SYSINFO=''
	SCREENSHOT=''
	SESSION=''
	MEDIA=''
	MUSIC=''
	
CUSTOM_MODI="\
${SYSINFO}:${rofi_center_modi_path}/modi-sysinfo.sh,\
${SCREENSHOT}:${rofi_center_modi_path}/modi-screenshot.sh,\
${SESSION}:${rofi_center_modi_path}/modi-session.sh,\
${MEDIA}:${rofi_center_modi_path}/modi-media.sh,\
${MUSIC}:${rofi_center_modi_path}/modi-music.sh"

	case "${__opt}" in
    	sys*) MODI="$SYSINFO"
    	;;
    	scr*) MODI="$SCREENSHOT"
    	;;
    	ses*) MODI="$SESSION"
    	;;
    	med*) MODI="$MEDIA"
    	;;
    	mus*) MODI="$MUSIC"
    	;;
	esac
	exec rofi -config "config.rasi" -theme-str '@import "exts.rasi"' \
          	-modi "$CUSTOM_MODI" \
          	-no-show-icons \
          	-no-lazy-grab \
          	-no-plugins \
          	-kb-custom-19 '' \
          	-kb-move-char-back '' \
          	-kb-move-char-forward '' \
          	-kb-mode-previous 'Left' \
          	-kb-mode-next 'Right' \
          	-show "${MODI:-${SYSINFO}}"
}

case "${__opt}" in
	wallpaper) __wall ;;
	launcher) __rofi_launcher ;;
	button) __BUTTON ;;
	*) __center ;;
esac
exit ${?}

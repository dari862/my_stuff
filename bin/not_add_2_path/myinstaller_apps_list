#!/bin/sh
. "$__distro_path_lib"
. "${__distro_path_root}/lib/common/DB"
. "${__distro_path_root}/lib/common/my_installer_and_DB_dir"
. "${__distro_path_root}/lib/common/system_ready"

X11_apps_2_remove="$(grep -rI "# X11 only package remove it from my-installer" "$_APPS_LIBDIR" | awk -F: '{print $1}' | xargs -n1 basename | tr '\n' '|' | sed 's/|$//')"

wayland_apps_2_remove="$(grep -rI "# wayland only package remove it from my-installer" "$_APPS_LIBDIR" | awk -F: '{print $1}' | xargs -n1 basename | tr '\n' '|' | sed 's/|$//')"

{
	cd "${apps_db_path}"
	for dir in *;do
		apps_dir_name=$(echo "$dir" | sed 's/_/ /')
		apps_in_dir="$(cat "$dir" 2>/dev/null)"
		[ -n "$apps_in_dir" ] && apps_in_dir="$(echo "$apps_in_dir" | grep -vE "$wayland_apps_2_remove" || echo "$apps_in_dir")"
		[ -z "$apps_in_dir" ] && continue
		for app in $apps_in_dir;do
			echo "${app} ;| $apps_dir_name (Apps)"
		done
	done
	
	if ! check_system_ready_file "Gaming_ready";then
		echo "GPU ;| install GPU"
	else
		cd "${gaming_db_path}"
		for file in *;do
			apps_dir_name=$(echo "$file" | sed 's/_/ /')
			apps_in_dir="$(cat "$file" 2>/dev/null)"
			[ -n "$apps_in_dir" ] && apps_in_dir="$(echo "$apps_in_dir" | grep -vE "$wayland_apps_2_remove" || echo "$apps_in_dir")"
			[ -z "$apps_in_dir" ] && continue
			for app in $apps_in_dir;do
				echo "${app} ;| $apps_dir_name (Gaming)"
			done
		done
	fi
} | column -t -s ';'

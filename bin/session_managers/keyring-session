#!/bin/sh

polkit_gnome_path="/usr/lib/policykit-1-gnome/polkit-gnome-authentication-agent-1"
xfce_polkit_path="/usr/lib/xfce-polkit/xfce-polkit"

if [ -f "${polkit_gnome_path}" ];then
	keyring_name="polkit-gnome-authentication-agent-1"
	keyring_path="/usr/lib/policykit-1-gnome/polkit-gnome-authentication-agent-1"
elif [ -f "${xfce_polkit_path}" ];then
	keyring_name="xfce-polkit"
	keyring_path="/usr/lib/xfce-polkit/xfce-polkit"
else
	echo "${polkit_gnome_path} not found. install policykit gnome or xfce-polkit"
fi

stop() {
	kill_process.sh "$keyring_name"
	wait
}

start() {
	pidof -q ${keyring_path} || ${keyring_path} &
}

init_(){
	if [ -d "/etc/xdg/autostart/" ];then
		list_of_polkit="$(grep -r "polkit" "/etc/xdg/autostart/" | awk -F: '{print $1}' | sort -u)"
		for polkit in $list_of_polkit;do
			grep -q "Hidden=true" "$polkit" || exit
		done
	fi
	start
}

case "${1}" in
	init)
		init_		
	;;
	""|restart)
		stop
		start		
	;;
	start)
		start		
	;;
	stop)	
		stop	
	;;
	*)	
		echo "Usage: keyring-session [start|stop|restart]"
	;;
esac

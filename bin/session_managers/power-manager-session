#!/bin/sh
set -e

. "$__distro_path_lib"
. "${__distro_path_root}/lib/common/WM"
sleep_time="${2:-0}"

stop(){
	__process_id="$(pgrep -f my_power_manager 2>/dev/null || :)"
	if [ -n "$__process_id" ];then
		for pid in $__process_id;do
			if kill ${pid} >/dev/null 2>&1;then
				(kill -9 ${pid} >/dev/null 2>&1) &
			fi
		done
	fi
}

start() {
	sleep $sleep_time 
	"${__distro_path_root}"/bin/WM/kill_process.sh xfce4-power-manager
	( pgrep -f my_power_manager >/dev/null 2>&1 || setsid "${__distro_path_root}"/bin/X11/WM/my_power_manager ) &
}

case "${1}" in
	""|restart)
		stop
		start		
	;;
	start)
		start		
	;;
	stop)	
		stop	
	;;
	*)	
		echo "Usage: xfce4-power-manager-session [start|stop|restart]"
	;;
esac

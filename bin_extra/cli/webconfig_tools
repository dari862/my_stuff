#!/bin/bash
# need superuser : use my-superuser

EDITOR_CMD="${EDITOR_CMD:-nano}"

edit_first_found() {
    local label="$1"
    shift
    for file in "$@"; do
        if [ -f "$file" ]; then
            echo "Opening $label: $file"
            my-superuser "$EDITOR_CMD" "$file"
            return 0
        fi
    done

    echo "Error: $label file could not be found."
    echo "Searching system via locate..."
    my-superuser updatedb && locate "$(basename "$1")"
}

# --- Features ---

apachelog() {
    # Check common log directories
    local log_dir=""
    [ -d "/var/log/httpd" ] && log_dir="/var/log/httpd"
    [ -d "/var/log/apache2" ] && log_dir="/var/log/apache2"

    if [ -n "$log_dir" ]; then
        cd "$log_dir" && ls -xAh
        my-superuser multitail --no-repeat -c -s 2 "$log_dir"/*log
    else
        echo "Error: Could not find Apache log directory."
    fi
}

apacheconfig() {
    edit_first_found "Apache Config" \
        "/etc/httpd/conf/httpd.conf" \
        "/etc/apache2/apache2.conf" \
        "/etc/apache2/httpd.conf"
}

phpconfig() {
    edit_first_found "PHP Config" \
        "/etc/php.ini" \
        "/etc/php/8.3/apache2/php.ini" \
        "/etc/php/8.2/apache2/php.ini" \
        "/etc/php/7.4/apache2/php.ini" \
        "/etc/php/php.ini" \
        "/etc/php5/apache2/php.ini"
}

mysqlconfig() {
    edit_first_found "MySQL Config" \
        "/etc/my.cnf" \
        "/etc/mysql/my.cnf" \
        "/usr/local/etc/my.cnf" \
        "~/.my.cnf"
}

# --- Execution ---

case "$1" in
    apachelog|apacheconfig|phpconfig|mysqlconfig)
        "$1" # Dynamically calls the function matching the argument
        ;;
    *)
        echo "Usage: $(basename "$0") {apachelog|apacheconfig|phpconfig|mysqlconfig}"
        exit 1
        ;;
esac
